<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="ansible이란?"><meta name="keywords" content="ansible"><meta name="author" content="Sungbin Hong"><meta name="copyright" content="Sungbin Hong"><title>ansible이란? | devk0ng's blog</title><link rel="shortcut icon" href="/img/icon2.png"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="canonical" href="https://devk0ng.github.io/2022/02/16/ansible/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.css"><script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.1.1/dist/instantsearch.min.js" defer></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
  google_ad_client: 'ca-pub-3745226285485669',
  enable_page_level_ads: 'true'
});
</script><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: {"appId":"LK74G203SS","apiKey":"82b60d701a0005a22c7f6e2476b74ac1","indexName":"myblog","hits":{"per_page":10},"languages":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}.","hits_stats":"${hits} results found in ${time} ms"}},
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="devk0ng's blog" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Ansible-%EC%9D%B4%EB%9E%80"><span class="toc-number">1.</span> <span class="toc-text">Ansible 이란?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Ansible%EC%97%90-%EB%8C%80%ED%95%98%EC%97%AC"><span class="toc-number">2.</span> <span class="toc-text">Ansible에 대하여</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%ED%8A%B9%EC%A7%95"><span class="toc-number">2.1.</span> <span class="toc-text">특징</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EA%B5%AC%EC%A1%B0"><span class="toc-number">2.2.</span> <span class="toc-text">구조</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Inventory"><span class="toc-number">2.2.1.</span> <span class="toc-text">Inventory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#playbook"><span class="toc-number">2.2.2.</span> <span class="toc-text">playbook</span></a></li></ol></li></ol></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/icon2.png"></div><div class="author-info__name text-center">Sungbin Hong</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">37</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">36</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">14</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(/img/background2.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">devk0ng's blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"><a class="site-page social-icon search"><i class="fa fa-search"></i><span> Search</span></a></span></div><div id="post-info"><div id="post-title">ansible이란?</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-16</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/deploy/">deploy</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="Ansible-이란"><a href="#Ansible-이란" class="headerlink" title="Ansible 이란?"></a>Ansible 이란?</h1><p>기존엔 프로그램이 돌아가기 위한 실행환경을 만드는 데에 쉘 스크립트를 일반적으로 사용했어.</p>
<p>쉘 스크립트에 설치하고자하는 패키지나 혹은 그 외 다른 명령어들의 나열을 통해 원하고자 하는 실행흐름을 만들었지.</p>
<p>하지만 요즈음 여러 기술들의 발전과 함께 관리해야하는 서버의 숫자가 급격하게 증가하고 있어.</p>
<p>이러한 상황속에서 단순 쉘 스크립트만으로는 관리하기에 어려운 상황인거지.</p>
<span id="more"></span>
<p>이를 해결하기 위해 나온게 IaC(Infrastructure as a Code). 이는 컴퓨터의 인프라 구성을 소프트웨어를 개발하는 것처럼 코드로 작성하는 것을 의미한다. Ansible 또한 IaC 개념이 도입 되어 자동화 도구를 이용하여 인프라의 설정을 코드로 작성하고 이를 모든 서버에 배포함으로써 특정 환경을 동일하게 유지할 수 있도록 도와준데</p>
<p><br><br><br></p>
<h1 id="Ansible에-대하여"><a href="#Ansible에-대하여" class="headerlink" title="Ansible에 대하여"></a>Ansible에 대하여</h1><p><br><br></p>
<h2 id="특징"><a href="#특징" class="headerlink" title="특징"></a>특징</h2><ul>
<li>provisioning : 다양한 서버를 셋업할 수 있게 해줘!</li>
<li>configuration management : os, device 혹은 application의 설정을 변경하게 해줘! 그리고 이를 추적 가능하게 해줘!! 결국 이 또한 형상관리 툴에 의해 추적될 수 있기 때문에 그 기록을 볼 수 있지.</li>
<li>application deployment : product 서버에 프로그램 배포를 자동화할 수 있게 해줘. 즉 devops를 쉽게 할 수 있도록 도와줘</li>
<li>agentless : agent가 붙어서 동작하는 방식이 아니야!! 일반적인 자동화 도구들은 agent가 붙어 pull 형태로 이루어지지만 ansible의 경우 agent없이 push하는 방식이야.</li>
</ul>
<p><br><br></p>
<h2 id="구조"><a href="#구조" class="headerlink" title="구조"></a>구조</h2><img src="https://user-images.githubusercontent.com/31160622/154101065-1991cbe4-64a4-40f5-af03-4c601f1a2785.png">

<p>크게 위의 구조처럼 생겼어.</p>
<p>제어노드가 ansible이 설치되어있는 서버라고 생각하면 될 것 같애. </p>
<p>그리고 이 제어노드가 ansible을 이용해 관리 대상이 되는 서버들에게 일괄적으로 처리해야할 작업들을 손쉽게 동작할 수 있게 하는거지.</p>
<p>그리고 이때 통신에는 ssh를 사용해.</p>
<p>이렇게 통신할 때 어떤 것이 필요할까? 크게 다음 두가지겠지</p>
<ol>
<li>접속정보 : 관리 대상이 되는 서버들에 대해 접속 ip나 혹은 login 정보 등이 필요하겠지 = Inventory files</li>
<li>명령어 : 어떤 명령을 실행할 지가 필요하겠지. ansible 에서는 한가지 명령어를 실행하는 방식을 ad-hoc command라고 불러. 그리고 여러 명령어의 시나리오를 파일로 만들어 실행하는 방법을 playbook이라고해.</li>
</ol>
<p>조금 더 들어가보면</p>
<br>

<h3 id="Inventory"><a href="#Inventory" class="headerlink" title="Inventory"></a>Inventory</h3><p>인벤토리 파일에는 위에서 말했듯이 접속정보가 주어져.</p>
<p>이 인벤토리 파일의 형식에는 크게 두가지가 존재해.</p>
<p>먼저 첫번째로 아래와 같은 INI형식.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mail.example.com</span><br><span class="line">[webservers]</span><br><span class="line">foo.example.com</span><br><span class="line">bar.example.com</span><br><span class="line">[dbservers]</span><br><span class="line">one.example.com</span><br><span class="line">two.example.com</span><br><span class="line">three.example.com</span><br></pre></td></tr></table></figure>

<p>두번 째는 아래 예시처럼 YAML 형식.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">all:</span></span><br><span class="line">  <span class="attr">hosts:</span></span><br><span class="line">    <span class="attr">mail.example.com:</span></span><br><span class="line">  <span class="attr">children:</span></span><br><span class="line">    <span class="attr">webservers:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">foo.example.com:</span></span><br><span class="line">        <span class="attr">bar.example.com:</span></span><br><span class="line">    <span class="attr">dbservers:</span></span><br><span class="line">      <span class="attr">hosts:</span></span><br><span class="line">        <span class="attr">one.example.com:</span></span><br><span class="line">        <span class="attr">two.example.com:</span></span><br><span class="line">        <span class="attr">three.example.com:</span></span><br></pre></td></tr></table></figure>

<p>이렇게 접속하고자 하는 대상의 정보를 인벤토리 파일에 정의해. 이때 단순 접속하고자 하는 도메인 혹은 ip를 제외하고도 추가적인 정보를 넣을 수 있어.</p>
<p>예를들어, 넘겨야하는 변수들이나 혹은 sudo 권한 획득을 위한 정보 등 여러 정보들을 추가할 수 있어.</p>
<p>또 ssh 통신을 사용하기에 default로 23 port를 이용하지만 만약 다른 포트로 열어놨다하면 해당 파일에서 </p>
<p>domain(ip) ansible_port=xx 이런식으로 옵션을 줄 수도 있어. 이런 방법들은 내용이 방대하기에 공식 문서를 참고하는게 좋아.</p>
<p>그리고 각 도메인 혹은 Ip 위에 [ group name ] 을 볼 수 있는데 이렇게 그룹을 지정해 그룹별로 원하는 작업을 진행할 수 있어.</p>
<br>

<h3 id="playbook"><a href="#playbook" class="headerlink" title="playbook"></a>playbook</h3><p>playbook은 위에서 설명했듯이 관리 대상이 되는 서버들에 대해 작업해야할 정보들이 담겨있어.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Update</span> <span class="string">web</span> <span class="string">servers</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">webservers</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">apache</span> <span class="string">is</span> <span class="string">at</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">version</span></span><br><span class="line">    <span class="attr">ansible.builtin.yum:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">httpd</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Write</span> <span class="string">the</span> <span class="string">apache</span> <span class="string">config</span> <span class="string">file</span></span><br><span class="line">    <span class="attr">ansible.builtin.template:</span></span><br><span class="line">      <span class="attr">src:</span> <span class="string">/srv/httpd.j2</span></span><br><span class="line">      <span class="attr">dest:</span> <span class="string">/etc/httpd.conf</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Update</span> <span class="string">db</span> <span class="string">servers</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">databases</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">postgresql</span> <span class="string">is</span> <span class="string">at</span> <span class="string">the</span> <span class="string">latest</span> <span class="string">version</span></span><br><span class="line">    <span class="attr">ansible.builtin.yum:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">postgresql</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">latest</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Ensure</span> <span class="string">that</span> <span class="string">postgresql</span> <span class="string">is</span> <span class="string">started</span></span><br><span class="line">    <span class="attr">ansible.builtin.service:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">postgresql</span></span><br><span class="line">      <span class="attr">state:</span> <span class="string">started</span></span><br></pre></td></tr></table></figure>

<p>위처럼 줄 수 있어. 이때 시작할 때 —- 구분자 넣는 거 까먹으면 no!</p>
<p>위의 속성들을 간단히 설명해보자면</p>
<ul>
<li>host : 어떤 대상으로 할 것인가 (group, remote server)</li>
<li>vars : 위의 예시에는 없으나 사용할 변수를 지정해 놓을 수 있어.</li>
<li>tasks : 수행해야할 작업들 내용이 하위에 와. 이름과 모듈 등 리스트 형태로 진행해야할 작업들의 시나리오가 와.</li>
<li>handlers : 얘도 위의 예시에서는 없지만 태스크에서 진행되는 작업을 정의할 수 있어. (a call by tasks. it will run only once, after all of the tasks complete)</li>
</ul>
<p>playbook을 작성하다보면 하나의 큰 파일이 될 수 있는데 그럴 경우 재사용성에서 좋지 않아.</p>
<p>그래서 include, import를 사용하여 파일을 쪼갤 수 있어. 이 둘은 느낌상 컴파일러와 인터프리터의 느낌처럼 언제 처리되는지의 차이만 가지고있지 유사하다고 볼 수 있어.</p>
<ol>
<li>import : 플레이북이 파싱되는 동안에 pre-processed 된데. (all import statements are pre-processed at the time playbooks are parsed</li>
<li>include : all include statements are processed as they encountered during the execution of the playbook.</li>
</ol>
<br>

<p>이 외에도 roles 즉 각각의 role들을 분리해서 관리할 수 있어.</p>
<p>ansible 에서는 group에 맞게 directory를 구성할 경우 알아서 읽어와 실행해줘. </p>
<p>이 부분은 공식문서를 참조하는 것이 좋아.</p>
<p>위에서 한번 언급했듯이</p>
<p>ansible 명령어를 통해 한 모듈을(모듈은 굉장히 많은 종류가 존재하며 상세 종류 별 기능은 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.ansible.com/ansible/2.9/modules/list_of_all_modules.html">공식 document</a> 참조) 대상(hosts)에 적용하는 것이 ad-hoc command이고</p>
<p>ansible-playbook 명령어를 통해 여러 무듈을 대상(hosts)에 적용하는 방식이 playbook이야.</p>
<br>

<p>이러한 명령어들은 구조를 어떻게 하는지, 혹은 원하는 옵션이 무엇인지에 따라 내용이 방대해지기에 ansible이 어떤 것인지 이해한 후 부터는 공식문서의 guide를 참조해 그때그때 찾아가서 사용하자!!</p>
<p>어느정도 이해가 되어 효율적인 구조를 원하는 경우 <a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.ansible.com/ansible/2.8/user_guide/playbooks_best_practices.html#best-practices">ansible best practice</a> 를 참조하면 좋을 것 같애</p>
<p><br><br><br><br><br><br><br></p>
<blockquote>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://docs.ansible.com/ansible/latest/user_guide/index.html#getting-started">https://docs.ansible.com/ansible/latest/user_guide/index.html#getting-started</a></p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://velog.io/@honghwahyeong/Ansible-Ansible-%EC%9D%B4%EB%9E%80">https://velog.io/@honghwahyeong/Ansible-Ansible-이란</a></p>
<p><a target="_blank" rel="external nofollow noopener noreferrer" href="https://www.youtube.com/watch?v=-FD96PhaRkQ">https://www.youtube.com/watch?v=-FD96PhaRkQ</a></p>
</blockquote>
</div></article><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ansible/">ansible</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2022/02/14/kerberos/"><span>커버로스(kerberos) 인증이란</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: 'a9fadaa0c71177598341',
  clientSecret: '677df1a9ceea07288fecd99348d15054f5659172',
  repo: 'devk0ng.github.io',
  owner: 'devk0ng',
  admin: 'devk0ng',
  id: md5(decodeURI(location.pathname)),
  language: 'en'
})
gitalk.render('gitalk-container')</script></div></div><footer class="footer-bg" style="background-image: url(/img/background2.png)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By Sungbin Hong</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="external nofollow noopener noreferrer" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script src="/js/search/algolia.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script><div class="search-dialog" id="algolia-search"><div class="search-dialog__title" id="algolia-search-title">Algolia</div><div id="algolia-input-panel"><div id="algolia-search-input"></div></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-stats"></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div></body></html>